<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESRI Font Symbol Exporter v3.6</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/opentype.js/1.3.4/opentype.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#1a202c;min-height:100vh;padding:20px}
    .container{max-width:1100px;margin:0 auto;background:#2d3748;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.5);padding:40px}
    h1{color:#e2e8f0;margin-bottom:30px;font-size:2em}

    .loading-banner{background:#4a5568;padding:10px 20px;border-radius:8px;margin-bottom:20px;text-align:center;color:#e2e8f0;display:flex;flex-direction:column;align-items:center}
    .header-button-row{display:flex;gap:15px;align-items:center;justify-content:center;width:100%}
    .load-font-btn,.copy-path-btn{padding:8px 18px;font-size:.9em;background:#48bb78;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:.2s}
    .load-font-btn:hover,.copy-path-btn:hover{background:#38a169}
    .copy-path-btn.copied{background:#2f855a}
    @keyframes copy-glow{0%{box-shadow:0 0 0 0 rgba(72,187,120,.8)}50%{box-shadow:0 0 10px 5px rgba(72,187,120,.5)}100%{box-shadow:0 0 0 0 rgba(72,187,120,0)}}
    .copy-path-btn.glowing{animation:copy-glow .8s ease-out forwards}
    .load-status-bar{width:100%;text-align:center;margin-top:5px;font-size:.85em;font-weight:600;color:#48bb78;min-height:1.2em}

    .input-section{background:#1a202c;padding:25px;border-radius:12px;margin-bottom:30px}
    .input-group{margin-bottom:0;position:relative}
    .input-with-button-wrap{display:flex;align-items:center;gap:10px}
    label{display:block;margin-bottom:8px;color:#e2e8f0;font-weight:600;font-size:.9em}
    input,select{width:100%;padding:12px 15px;border:2px solid #4a5568;background:#2d3748;color:#e2e8f0;border-radius:8px;font-size:1em;transition:border-color .3s}
    input:focus,select:focus{outline:none;border-color:#667eea}
    input::placeholder{color:#718096}
    .clear-font-btn{background:#667eea;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:.85em;font-weight:600;z-index:1;height:44px}
    .clear-font-btn:hover{background:#5568d3}

    /* Adjusted 4-column row after removing Preview */
    .input-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;align-items:end}
    .btn-inline{width:100%;height:44px;border:none;border-radius:8px;font-weight:700;cursor:pointer;transition:.15s}
    .btn-inline:active{transform:translateY(1px)}
    .btn-download{background:#48bb78;color:#fff}
    .btn-download:hover{background:#38a169}
    .btn-download:disabled{background:#4a5568;cursor:not-allowed}

    .input-row-three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;margin-bottom:20px}
    .input-row-three-col .input-group{margin-bottom:0}

    .font-dropdown{position:absolute;background:#1a202c;border:2px solid #4a5568;border-radius:8px;max-height:300px;overflow-y:auto;width:100%;margin-top:5px;box-shadow:0 10px 25px rgba(0,0,0,.5);z-index:1000}
    .font-option{padding:12px 15px;cursor:pointer;transition:background .2s;border-bottom:1px solid #2d3748;color:#e2e8f0}
    .font-option:hover{background:#2d3748}
    .no-results{padding:15px;text-align:center;color:#718096;font-style:italic}

    .toggle-group{display:flex;gap:10px;align-items:center}
    .toggle-btn{flex:1;padding:10px 20px;border:2px solid #4a5568;background:#2d3748;color:#e2e8f0;border-radius:8px;cursor:pointer;font-weight:600;transition:.2s}
    .toggle-btn.active{background:#667eea;color:#fff;border-color:#667eea}

    .preview-section{margin-top:30px}
    .preview-title{font-size:1.1em;font-weight:600;color:#e2e8f0;margin-bottom:15px}
    .preview-split{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{background:#1a202c;border:2px dashed #4a5568;border-radius:12px;min-height:320px;padding:16px;display:flex;align-items:flex-start;justify-content:center;position:relative}
    .card-inner{width:100%;max-width:520px;min-height:288px;display:flex;align-items:flex-start;justify-content:center}
    #previewCanvasHost{width:100%;height:288px;border-radius:10px;position:relative}

    .bg-controls{width:100%;display:flex;flex-direction:column;gap:16px}
    .control-block{background:#2d3748;border:1px solid #4a5568;border-radius:10px;padding:12px}
    .control-title{color:#cbd5e0;font-weight:700;font-size:.95em;margin-bottom:8px}
    .shape-toggle{display:flex;gap:8px}
    .shape-btn{flex:1;padding:10px;border:2px solid #4a5568;background:#1a202c;color:#e2e8f0;border-radius:8px;cursor:pointer;font-weight:700}
    .shape-btn.active{border-color:#667eea;background:#2d3478a0}
    .shape-btn.toggled{background:#667eea;color:#fff;border-color:#667eea}

    .size-row{display:grid;grid-template-columns:1fr auto;align-items:center;gap:10px}
    .size-row .unit-toggle{display:flex;gap:8px}
    .unit-btn{padding:8px 10px;border:2px solid #4a5568;background:#1a202c;color:#e2e8f0;border-radius:8px;cursor:pointer;font-weight:600}
    .unit-btn.active{border-color:#667eea;background:#2d3478a0}
    input[type="range"]{width:100%}

    .dpad-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .dpad{display:grid;grid-template-columns:40px 40px 40px;grid-template-rows:40px 40px 40px;gap:6px;justify-content:center;align-items:center;margin-top:6px}
    .dpad button{width:40px;height:40px;border:1px solid #4a5568;background:#1a202c;color:#e2e8f0;border-radius:8px;font-size:20px;cursor:pointer}
    .dpad button:hover{border-color:#667eea}
    .dpad .center{font-size:18px}

    .under-preview{margin-top:14px;display:grid;grid-template-columns:1fr;gap:10px}
    .color-toggle{display:flex;gap:8px}
    .color-toggle .toggle-btn{flex:0 0 auto;padding:8px 14px}
    #colorInput{width:100%;height:44px;padding:0;border:2px solid #4a5568;background:#2d3748;border-radius:8px;cursor:pointer;-webkit-appearance:none;appearance:none;overflow:hidden}
    #colorInput::-webkit-color-swatch-wrapper{padding:0}
    #colorInput::-webkit-color-swatch{border:none;border-radius:6px}
    #colorInput::-moz-color-swatch{border:none;border-radius:6px}

    @media(max-width:1020px){.preview-split{grid-template-columns:1fr}}
    @media(max-width:900px){.input-row,.input-row-three-col{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>ESRI Font Symbol Exporter v3.6</h1>
    <div id="loadingBanner" class="loading-banner"></div>
    <input type="file" id="fontFileInput" accept=".ttf,.otf" multiple style="display:none"/>

    <div class="input-section">
      <div class="input-group" style="margin-bottom:20px">
        <label for="fontSearch">Select ESRI Font <span id="fontCount"></span></label>
        <div class="input-with-button-wrap">
          <input type="text" id="fontSearch" placeholder="Search loaded fonts..." autocomplete="off"/>
          <button class="clear-font-btn" id="clearFontBtn" onclick="clearFontSelection()" style="display:none">Clear</button>
        </div>
        <div id="fontDropdown" class="font-dropdown" style="display:none"></div>
        <input type="hidden" id="fontSelect"/>
      </div>

      <!-- Unified Inputs and Download -->
      <div class="input-row">
        <div class="input-group">
          <label for="keyInput">Key</label>
          <input type="text" id="keyInput" placeholder="A" maxlength="10"/>
        </div>
        <div class="input-group">
          <label for="decimalInput">Decimal</label>
          <input type="number" id="decimalInput" placeholder="65" min="0" max="65535"/>
        </div>
        <div class="input-group">
          <label for="hexInput">Hex</label>
          <input type="text" id="hexInput" placeholder="41" maxlength="6"/>
        </div>
        <button class="btn-inline btn-download" id="downloadBtn" onclick="downloadSymbol()" disabled>Download</button>
      </div>
